jQuery(document).ready(function(o){var e=!1,t={vars:gmw_lf_args.args,is_location_confirmed:0!=o.trim(o("#gmw_lf_latitude").val()).length&&0!=o.trim(o("#gmw_lf_longitude").val()).length?!0:!1,security:gmw_lf_args.nonce,fields:gmw_lf_args.fields,messages:gmw_lf_args.messages,wrapper_element:".gmw-location-form-wrapper",location_fields:gmw_lf_args.fields.location.fields||!1,address_fields:gmw_lf_args.fields.address.fields||!1,coords_fields:gmw_lf_args.fields.coordinates.fields||!1,action_fields:gmw_lf_args.fields.actions.fields||!1,map_enabled:o("#gmw-lf-map").length?!0:!1,fields_changed:1,map_options:{},autocomplete_options:{},region:"US",proceed_submission:!1,location_exists:!1,auto_confirming:!1,init:function(){this_form=t,o("#"+this_form.action_fields.confirm_location.id).fadeOut("fast"),this_form.is_location_confirmed?(this_form.location_exists=!0,this_form.action_message("ok",this_form.messages.location_exists),this_form.is_location_confirmed=location_saved=!0):(this_form.location_exists=!1,o("#"+this_form.action_fields.delete_location.id).fadeOut("fast"),this_form.action_message("error",this_form.messages.location_not_exists)),this_form.init_tabs(),this_form.fields_changed(),this_form.action_buttons(),this_form.vars.address_autocomplete&&o(".gmw-lf-address-autocomplete").length&&this_form.address_autocomplete(),this_form.map_enabled&&o("#gmw-lf-map").length&&this_form.render_map(),this_form.vars.geolocation_button&&o(".gmw-lf-locator-button").length?this_form.current_location():o(".gmw-lf-locator-button").remove(),o(this_form.vars.form_element).on("submit",function(o){return!this_form.location_exists&&this_form.vars.location_required?(alert(this_form.messages.location_required),!1):void(this_form.proceed_submission||(o.preventDefault(),this_form.vars.auto_confirm?this_form.auto_confirm_submission(!0):this_form.confirm_submission(!0)))})},init_tabs:function(){firstTab=o(".gmw-lf-tabs-wrapper li").first().attr("id"),o("#"+firstTab+"-panel").show().siblings().hide(),void 0!==typeof this_form.vars.exclude_fields_groups&&this_form.vars.exclude_fields_groups.length&&o.each(this_form.vars.exclude_fields_groups,function(e,t){o("#"+t+"-tab-panel").remove()}),o(".gmw-lf-tabs-wrapper li a").on("click",function(e){e.preventDefault();var t=jQuery(this).data("name");jQuery("#"+t+"-tab-panel").show().siblings().hide(),jQuery(this).parent("li").addClass("active").siblings().removeClass("active"),this_form.map_enabled&&1==o(t+"-tab-panel").find(o("#"+this_form.location_fields.map.id)).length&&setTimeout(function(){google.maps.event.trigger(this_form.map,"resize"),this_form.map.setCenter(this_form.map_marker.getPosition())},100)})},action_message:function(e,t,s){"updating"==e?(o("#"+this_form.action_fields.message.id).removeClass("changed ok error confirming").addClass("confirming").find("span").html(t),s&&o("#"+this_form.action_fields.message.id).fadeIn("fast")):o("#"+this_form.action_fields.loader.id).fadeOut("fast",function(){o("#"+this_form.action_fields.message.id).removeClass("changed ok error confirming").addClass(e).find("span").html(t),s&&o("#"+this_form.action_fields.message.id).fadeIn("fast")})},action_buttons:function(){o(this_form.wrapper_element+' input[type="text"]').keypress(function(o){return 13==o.which?!1:void 0}),o("#"+this_form.location_fields.address.id).length&&o("#"+this_form.location_fields.address.id).on("keydown",function(e){13==e.which&&(!o(this).hasClass("gmw-lf-address-autocomplete")||o(this).hasClass("gmw-lf-address-autocomplete")&&"none"==o(".pac-container").css("display"))&&(this_form.fields_changed=1,this_form.confirm_location())}),o("#"+this_form.action_fields.submit_location.id).length&&o("#"+this_form.action_fields.submit_location.id).on("click",function(){this_form.vars.auto_confirm?this_form.auto_confirm_submission(!1):this_form.confirm_submission(!1)}),o("#"+this_form.action_fields.confirm_location.id).length&&o("#"+this_form.action_fields.confirm_location.id).on("click",function(){this_form.confirm_location()}),o("#"+this_form.action_fields.delete_location.id).length&&o("#"+this_form.action_fields.delete_location.id).on("click",function(){return confirm(this_form.messages.delete_confirmation)?void this_form.delete_location():!1})},fields_changed:function(){o(".gmw-lf-field.address-field, .gmw-lf-field.group_address, .gmw-lf-field.group_coordinates").on("change input",function(e){o(this).hasClass("address-field")?this_form.fields_changed=1:o(this).hasClass("group_address")?this_form.fields_changed=2:o(this).hasClass("group_coordinates")&&(this_form.fields_changed=3),o("#"+o(this).attr("id").replace(/-/g,"_")).val(o(this).val()),o("p.gmw-lf-form-action").hasClass("changed")||this_form.location_changed()})},location_changed:function(){this_form.vars.auto_confirm||o("#"+this_form.action_fields.confirm_location.id).fadeIn("fast"),this_form.location_exists=!0,this_form.action_message("changed",this_form.messages.location_changed),this_form.is_location_confirmed=!1},render_map:function(){this_form.is_location_confirmed?(lat=o("#gmw_lf_latitude").val(),lng=o("#gmw_lf_longitude").val()):(lat=this_form.vars.map_lat,lng=this_form.vars.map_lng),latLng=new google.maps.LatLng(lat,lng),map_options={zoom:parseInt(this_form.vars.map_zoom_level),center:latLng,mapTypeId:google.maps.MapTypeId[this_form.vars.map_type]},map_options=GMW.apply_filters("gmw_lf_render_map_options",map_options,this_form),this_form.map=new google.maps.Map(document.getElementById(this_form.location_fields.map.id),map_options),marker_options={position:latLng,map:this_form.map,draggable:!0},marker_options=GMW.apply_filters("gmw_lf_render_map_marker_options",marker_options,this_form),this_form.map_marker=new google.maps.Marker(marker_options),GMW.do_action("gmw_lf_render_map",this_form),google.maps.event.addListener(this_form.map_marker,"dragend",function(e){o(".group_coordinates, .group_address,#"+this_form.location_fields.address.id).val(""),this_form.location_changed(),this_form.reverse_geocode(e.latLng.lat(),e.latLng.lng(),!1)})},update_map:function(o,e){latLng=new google.maps.LatLng(o,e),this_form.map_marker.setPosition(latLng),this_form.map.panTo(latLng),GMW.do_action("gmw_lf_update_map",this_form,latLng)},address_autocomplete:function(){o(".gmw-lf-address-autocomplete").each(function(){autocompleteId=o(this).attr("id"),input=document.getElementById(autocompleteId),options=GMW.apply_filters("gmw_lf_address_autocomplete_options",{},autocompleteId,this_form);var e=new google.maps.places.Autocomplete(input,options);google.maps.event.addListener(e,"place_changed",function(){place=e.getPlace(),place.geometry&&(GMW.do_action("gmw_lf_autocomplete_place_changed",place,this_form),o(".group_coordinates, .group_address").val(""),o(".group_coordinates.latitude").val(place.geometry.location.lat()),o(".group_coordinates.longitude").val(place.geometry.location.lng()),o("#gmw_lf_address, #gmw_lf_formatted_address").val(o("#"+this_form.location_fields.address.id).val()),this_form.get_address_fields(place,!1))})})},current_location:function(){o("#gmw-lf-locator-button").on("click",function(){o("#gmw-lf-locator-button").addClass("animate-spin"),navigator.geolocation?(options=GMW.apply_filters("gmw_lf_navigator_options",{timeout:15e3},this_form),navigator.geolocation.getCurrentPosition(this_form.show_position,this_form.show_error,options)):(alert("Geolocation is not supported by this browser."),o("#gmw-lf-locator-button").removeClass("animate-spin"))})},show_position:function(e){o("#gmw-lf-locator-button").removeClass("animate-spin"),this_form.reverse_geocode(e.coords.latitude,e.coords.longitude,!1)},show_error:function(e){switch(e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:alert("An unknown error occurred.")}this_form.is_location_confirmed=!1,o("#gmw-lf-locator-button").removeClass("animate-spin")},geocode:function(e){var e=e;0==o.trim(e).length?this_form.location_blank():(geocoder=new google.maps.Geocoder,data={address:e,region:this_form.region},geocoder.geocode(data,function(t,s){s==google.maps.GeocoderStatus.OK?(lat=t[0].geometry.location.lat(),lng=t[0].geometry.location.lng(),1==this_form.fields_changed?o(".group_coordinates, .group_address").val(""):2==this_form.fields_changed&&o(".group_coordinates, .gmw-lf-submission-field.group_address, #"+this_form.location_fields.address.id).val(""),o(".group_coordinates.latitude").val(lat),o(".group_coordinates.longitude").val(lng),o("#"+this_form.location_fields.address.id+", #gmw_lf_address").val(e),o("#gmw_lf_formatted_address").val(t[0].formatted_address),this_form.get_address_fields(t[0],!0)):this_form.geocoder_failed(s)}))},reverse_geocode:function(e,t,s){o(".group_coordinates.latitude").val(e),o(".group_coordinates.longitude").val(t),geocoder=new google.maps.Geocoder,data={latLng:new google.maps.LatLng(e,t),region:this_form.region},geocoder.geocode(data,function(e,t){t==google.maps.GeocoderStatus.OK?(o(".group_address,"+this_form.location_fields.address.id).val(""),o("#"+this_form.location_fields.address.id+", #gmw_lf_address, #gmw_lf_formatted_address").val(e[0].formatted_address),this_form.get_address_fields(e[0],s)):this_form.geocoder_failed(t)})},location_blank:function(){this_form.is_location_confirmed=!1,alert(this_form.messages.location_blank),o("#"+this_form.action_fields.loader.id).fadeOut("fast")},geocoder_failed:function(e){this_form.is_location_confirmed=!1,alert(this_form.messages.geocoder_failed+" Error Message: "+e),o("#"+this_form.action_fields.loader.id).fadeOut("fast")},get_address_fields:function(e,t){ac=e.address_components,pid=void 0!==typeof e.place_id?e.place_id:"",o(".group_address.place_id").val(pid);var s={street_number:null,street_name:null,street:null,premise:null,neighborhood:null,city:null,county:null,region_name:null,region_code:null,postcode:null,country_name:null,country_code:null,latitude:null,longitude:null,formatted_address:null};ac=GMW.apply_filters("gmw_lf_address_component",ac,this_form);for(x in ac)"street_number"==ac[x].types&&void 0!=ac[x].long_name&&(s.street_number=ac[x].long_name,o(".group_address.street_number").val(ac[x].long_name)),"route"==ac[x].types&&void 0!=ac[x].long_name&&(s.street_name=ac[x].long_name,o(".group_address.street_name").val(ac[x].long_name),s.street=o(".group_address.street_number").val()+" "+o(".group_address.street_name").val(),o(".group_address.street").val(s.street)),"subpremise"==ac[x].types&&void 0!=ac[x].long_name&&(s.premise=ac[x].long_name,o(".group_address.premise").val(ac[x].long_name)),"neighborhood,political"==ac[x].types&&void 0!=ac[x].long_name&&(s.neighborhood=ac[x].long_name,o(".group_address.neighborhood").val(ac[x].long_name)),"locality,political"==ac[x].types&&void 0!=ac[x].long_name&&(s.city=ac[x].long_name,o(".group_address.city").val(ac[x].long_name)),"administrative_area_level_1,political"==ac[x].types&&(s.region_name=ac[x].long_name,o(".group_address.region_name").val(ac[x].long_name),s.region_code=ac[x].short_name,o(".group_address.region_code").val(ac[x].short_name)),"administrative_area_level_2,political"==ac[x].types&&void 0!=ac[x].long_name&&(s.county=ac[x].long_name,o(".group_address.county").val(ac[x].long_name)),"postal_code"==ac[x].types&&void 0!=ac[x].long_name&&(s.postcode=ac[x].long_name,o(".group_address.postcode").val(ac[x].long_name)),"country,political"==ac[x].types&&(s.country_name=ac[x].long_name,o(".group_address.country_name").val(ac[x].long_name),s.country_code=ac[x].short_name,o(".group_address.country_code").val(ac[x].short_name));s.latitude=o("#gmw_lf_latitude").val(),s.longitude=o("#gmw_lf_longitude").val(),s.formatted_address=o("#gmw_lf_formatted_address").val(),GMW.do_action("gmw_lf_geocoded_location_data",s,e,this_form),this_form.map_enabled&&o("#gmw-lf-map").length&&this_form.update_map(s.latitude,s.longitude),this_form.location_confirmed()},confirm_location:function(){this_form.is_location_confirmed?this_form.location_confirmed():(o("#"+this_form.action_fields.loader.id).fadeIn("fast"),latVal=lngVal="",0!=typeof this_form.coords_fields&&this_form.coords_fields.length&&(latVal=o("#"+this_form.coords_fields.latitude.id).val(),lngVal=o("#"+this_form.coords_fields.longitude.id).val()),3!=this_form.fields_changed||0==o.trim(latVal).length||0==o.trim(lngVal).length?(1==this_form.fields_changed&&o.trim(o("#"+this_form.location_fields.address.id).val()).length>0?address=o("#"+this_form.location_fields.address.id).val():(address="",o.each(this_form.address_fields,function(e,t){o("#"+t.id).length&&o.trim(o("#"+t.id).val()).length>0&&(address+=o("#"+t.id).val()+" ")})),0==o.trim(address).length&&0!=o.trim(latVal).length&&0!=o.trim(lngVal).length?this_form.reverse_geocode(latVal,lngVal,!0):this_form.geocode(address)):this_form.reverse_geocode(latVal,lngVal,!0))},auto_confirm_submission:function(e){var e=e;if(!this_form.location_exists)return this_form.vars.location_required?(this_form.location_blank(),!1):(this_form.proceed_submission=!0,o(this_form.vars.form_element).submit(),!1);if(this_form.is_location_confirmed)var t=0;else{var t=3e3;this_form.auto_confirming=!0,o("#"+this_form.action_fields.message.id).fadeOut("fast"),this_form.confirm_location()}setTimeout(function(){return this_form.is_location_confirmed?void(e||this_form.vars.stand_alone&&!this_form.vars.ajax_enabled?(this_form.proceed_submission=!0,this_form.auto_confirming=!1,o(this_form.vars.form_element).submit()):(this_form.auto_confirming=!1,this_form.save_location())):(this_form.auto_confirming=!1,!1)},t)},confirm_submission:function(e){var t=!1;return this_form.is_location_confirmed?t=!0:this_form.location_exists?this_form.vars.confirm_required?(alert(this_form.messages.confirm_required),t=!1):(lat=o("#gmw_lf_latitude").val(),lng=o("#gmw_lf_longitude").val(),0!=o.trim(lat).length&&0!=o.trim(lng).length&&o.isNumeric(lat)&&o.isNumeric(lng)?t=confirm(this_form.messages.confirm_message)?!0:!1:(alert(this_form.messages.coords_invalid),t=!1)):this_form.vars.location_required?(alert("no location"),t=!1):t=!0,t?void(e||this_form.vars.stand_alone&&!this_form.vars.ajax_enabled?(this_form.proceed_submission=!0,o(this_form.vars.form_element).submit()):this_form.save_location()):!1},location_confirmed:function(){this_form.auto_confirming||(o("#"+this_form.action_fields.confirm_location.id).fadeOut("fast"),o("#"+this_form.action_fields.delete_location.id).fadeIn("fast"),this_form.action_message("ok",this_form.messages.location_exists,!0)),o(".gmw-lf-field.address-field, .gmw-lf-field.group_address, .gmw-lf-field.group_coordinates").off("change"),this_form.is_location_confirmed=!0},save_location:function(){return o("#"+this_form.action_fields.message.id).fadeOut("fast",function(){o("#"+this_form.action_fields.loader.id).fadeIn("fast")}),e=o.ajax({type:"POST",dataType:"json",url:gmwAjaxUrl,data:{action:this_form.vars.update_callback,formValues:o(this_form.vars.form_element).serialize(),formArgs:this_form.vars,security:this_form.security},success:function(e){e?(o("#gmw_lf_location_id").val(e),o("#"+this_form.action_fields.confirm_location.id).fadeOut("fast",function(){this_form.action_message("ok",this_form.messages.location_saved,!0),setTimeout(function(){o("#"+this_form.action_fields.message.id+" span").html(this_form.messages.location_exists)},3500)})):this_form.action_message("error",this_form.messages.location_not_saved,!0)}}).fail(function(o,e,t){window.console&&window.console.log&&(console.log(e+": "+t),o.responseText&&console.log(o.responseText)),this_form.action_message("error",this_form.messages.location_not_saved,!0)}).done(function(o){console.log("done saving location"),console.log(o)}),!1},delete_location:function(){o("#"+this_form.action_fields.message.id).fadeOut("fast",function(){o("#"+this_form.action_fields.loader.id).fadeIn("fast"),o("#"+this_form.action_fields.confirm_location.id).fadeOut("fast")}),""!=o("#gmw_lf_location_id").val()&&"0"!=o("#gmw_lf_location_id").val()?this_form.ajax_delete():(o(".group_address, .group_coordinates, .gmw-lf-field.address-field, .gmw-lf-extra-field").val(""),this_form.is_location_confirmed=!1,setTimeout(function(){this_form.location_exists=!1,o("#"+this_form.action_fields.delete_location.id).fadeOut("fast"),this_form.action_message("ok",this_form.messages.location_deleted,!0),setTimeout(function(){this_form.action_message("error",this_form.messages.location_not_exists,!0)},3500)},1500))},ajax_delete:function(){return e=o.ajax({type:"post",dataType:"json",url:gmwAjaxUrl,data:{action:this_form.vars.delete_callback,formValues:o(this_form.vars.form_element).serialize(),formArgs:this_form.vars,security:this_form.security},success:function(e){e?(o(".group_address, .group_coordinates, .gmw-lf-field.address-field, .gmw-lf-extra-field, #gmw_lf_location_id").val(""),this_form.is_location_confirmed=!1,this_form.location_exists=!1,o("#"+this_form.action_fields.delete_location.id).fadeOut("fast"),this_form.action_message("ok",this_form.messages.location_deleted,!0),setTimeout(function(){this_form.action_message("error",this_form.messages.location_not_exists,!0)},3500)):this_form.action_message("error",this_form.messages.location_not_deleted,!0)}}).fail(function(o,e,t){window.console&&window.console.log&&(console.log(e+": "+t),o.responseText&&console.log(o.responseText)),this_form.action_message("error",this_form.messages.location_not_deleted,!0)}).done(function(o){console.log("done deleting location"),console.log(o)}),!1}};t.init()});