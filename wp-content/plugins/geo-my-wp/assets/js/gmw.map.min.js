var GMW_Maps={},GMW_Map=function(o,e,t){this.id=o.map_id,this.prefix=o.prefix,this.settings=o,this.gmw_form=t||!1,this.wrap_element=jQuery("#gmw-map-wrapper-"+this.id),this.map_element="gmw-map-"+this.id,this.options=e||{zoom:8,mapTypeId:"ROADMAP"},this.map=!1,this.locations=[],this.previous_locations=[],this.markers=[],this.icon_scaled_size=o.map_icon_width&&o.map_icon_height?new google.maps.Size(parseInt(o.map_icon_width),parseInt(o.map_icon_height)):null,this.hide_no_locations=o.hide_no_locations||!1,this.active_info_window=null,this.user_location=!1,this.user_position=!1,this.user_info_window=!1,this.clusters_path=o.clusters_path||this.default_cluster_path,this.grouping_type=o.group_markers||"standard",this.info_window_type=o.info_window_type||"standard",this.info_window_ajax=o.info_window_ajax||!1,this.info_window_template=o.info_window_template||"default",this.user_marker=!1,this.clusters=!1,this.bounds=!1,this.active_marker=null,this.polylines=[],this.auto_zoom_level=!1,this.zoom_position=o.zoom_position||!1,this.init()};GMW_Map.prototype.default_cluster_path="https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m",GMW_Map.prototype.init=function(){GMW.do_action("gmw_map_init",this)},GMW_Map.prototype.render=function(o,e){var t=this;if(jQuery("#"+t.map_element).length){if(t.locations=o||t.locations,t.user_location=e||t.user_location,t.bounds=new google.maps.LatLngBounds,"auto"==t.options.zoom?(t.auto_zoom_level=!0,t.options.zoom=13):(t.auto_zoom_level=!1,t.options.zoom=parseInt(t.options.zoom)),t.options.center=new google.maps.LatLng("40.758895","-73.985131"),t.options.mapTypeId=google.maps.MapTypeId[t.options.mapTypeId],t.options.mapTypeControlOptions={style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER},t.options.zoomControlOptions={position:google.maps.ControlPosition.RIGHT_CENTER},t.options.streetViewControlOptions={position:google.maps.ControlPosition.RIGHT_CENTER},0==t.locations.length&&t.hide_no_locations)var i="slideUp";else var i="slideDown";t.wrap_element[i]("fast",function(){t.map=new google.maps.Map(document.getElementById(t.map_element),t.options),google.maps.event.addListenerOnce(t.map,"idle",function(){if(jQuery("#gmw-map-loader-"+t.id).fadeOut(1e3),t.wrap_element.find(".gmw-map-cover").fadeOut(500),t.options.resizeMapControl&&0!=jQuery("#gmw-resize-map-toggle-"+t.id).length){var o=document.getElementById("gmw-resize-map-toggle-"+t.id);o.style.position="absolute",t.map.controls[google.maps.ControlPosition.TOP_RIGHT].push(o),o.style.display="block",jQuery("#gmw-resize-map-toggle-"+t.id).on("click",function(){var o=t.map.getCenter();t.wrap_element.toggleClass("gmw-expanded-map"),t.wrap_element.hasClass("gmw-expanded-map")?jQuery("body, html").addClass("gmw-scroll-disabled"):jQuery("body, html").removeClass("gmw-scroll-disabled"),jQuery(this).toggleClass("gmw-icon-resize-full").toggleClass("gmw-icon-resize-small"),setTimeout(function(){google.maps.event.trigger(t.map,"resize"),t.map.setCenter(o)},100)})}google.maps.event.addListener(t.map,"click",function(o){t.close_info_window()}),google.maps.event.addDomListener(t.map,"zoom_changed",function(o){t.close_info_window()}),t.render_user_marker(),t.render_markers(t.locations,!1)})})}},GMW_Map.prototype.update=function(o,e,t){var i=this;return i.locations=o||i.locations,i.user_location=e||i.user_location,0==i.locations.length&&i.hide_no_locations?void this.wrap_element.slideUp():i.map===!1?void i.render(i.locations,i.user_location):(i.bounds=new google.maps.LatLngBounds,i.close_info_window(),void i.wrap_element.slideDown("fast",function(){google.maps.event.trigger(i.map,"resize"),i.clear(),i.clear_user_marker(),i.render_user_marker(),i.render_markers(i.locations,t)}))},GMW_Map.prototype.clear=function(){for(var o=this,e=0;e<o.markers.length+1;e++)e<o.markers.length?o.markers[e]&&o.markers[e].setMap(null):(this.clear_polylines(),o.markers=[],this.markers_grouping_clear())},GMW_Map.prototype.clear_polylines=function(){for(var o=0;o<this.polylines.length+1;o++)o<this.polylines.length?this.polylines[o].setMap(null):this.polylines=[]},GMW_Map.prototype.markers_grouping_init=function(){"normal"==this.grouping_type&&(this.grouping_type="standard"),GMW.do_action("gmw_markers_grouping_init",this.grouping_type,this);var o=this.grouping_type+"_grouping_init";"function"==typeof this[o]?this[o]():console.log("The function "+o+" not exists.")},GMW_Map.prototype.markers_grouping_clear=function(){GMW.do_action("gmw_markers_grouping_clear",this.grouping_type,this);var o=this.grouping_type+"_grouping_clear";"function"==typeof this[o]?this[o]():console.log("The function "+o+" not exists.")},GMW_Map.prototype.standard_grouping_init=function(){},GMW_Map.prototype.standard_grouping_clear=function(){},GMW_Map.prototype.markers_clusterer_grouping_init=function(){"function"==typeof MarkerClusterer&&(this.clusters=new MarkerClusterer(this.map,this.markers,{imagePath:this.clusters_path,clusterClass:this.prefix+"-cluster cluster",maxZoom:15}))},GMW_Map.prototype.markers_clusterer_grouping_clear=function(){"function"==typeof MarkerClusterer&&0!=this.clusters&&this.clusters.clearMarkers()},GMW_Map.prototype.move_marker=function(o){var e=360/this.locations.length,t=o.lat()+-25e-6*Math.cos(+e*i/180*Math.PI),n=o.lng()+-25e-6*Math.sin(+e*i/180*Math.PI),s=new google.maps.LatLng(t,n);return this.polylines.push(new google.maps.Polyline({path:[o,s],strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:this.map})),s},GMW_Map.prototype.render_marker=function(o){var e=o.icon;"_default.png"==e&&(e=""),0!=this.icon_scaled_size&&""!=e&&(e={url:e,scaledSize:this.icon_scaled_size});var t={position:o.position,icon:e,map:this.map,animation:null,location_id:o.id,iw_content:o.content};return t=GMW.apply_filters("gmw_generate_marker_options",t,o.id,this),new google.maps.Marker(t)},GMW_Map.prototype.render_user_marker=function(){var o=this;if(0!=o.user_location&&0!=o.user_location.lat&&0!=o.user_location.lng&&"0"!=o.user_location.map_icon&&""!=o.user_location.map_icon){o.user_position=new google.maps.LatLng(o.user_location.lat,o.user_location.lng),o.bounds.extend(o.user_position);var e={position:o.user_position,icon:o.user_location.map_icon,id:"user_marker",content:""};o.user_marker=o.render_marker(e),0!=o.user_location.iw_content&&null!=o.user_location.iw_content&&(o.user_marker.iw_content='<span class="title">'+o.user_location.iw_content+"</span>",o.user_info_window=new google.maps.InfoWindow({content:'<div class="gmw-info-window user-marker map-'+this.id+" "+this.prefix+'">'+o.user_marker.iw_content+"</div>",maxHeight:"15px"}),google.maps.event.addListener(o.user_marker,"click",function(){o.user_info_window.open(o.map,o.user_marker)}),1==o.user_location.iw_open&&setTimeout(function(){o.user_info_window.open(o.map,o.user_marker)},500))}},GMW_Map.prototype.clear_user_marker=function(){0!=this.user_marker&&(this.user_marker.setMap(null),this.user_marker=!1,this.user_position=!1)},GMW_Map.prototype.render_markers=function(o,e){var t=this;GMW.do_action("gmw_map_pre_render_markers",o,this),t.markers_grouping_init(),t.locations=o,e&&0!=t.previous_locations.length?(temLoc=jQuery.merge(t.locations,t.previous_locations),t.previous_locations=t.locations,t.locations=temLoc):t.previous_locations=t.locations;var n=t.locations.length;for(0==n&&t.hide_no_locations&&this.wrap_element.slideUp(),i=0;i<n+1;i++)if(i<n){if(void 0==t.locations[i].lat||void 0==t.locations[i].lng||"0.000000"==t.locations[i].lat||"0.000000"==t.locations[i].lng)continue;var s=new google.maps.LatLng(t.locations[i].lat,t.locations[i].lng);"markers_spiderfier"!=t.grouping_type&&t.bounds.contains(s)&&(s=t.move_marker(s)),t.bounds.extend(s);var r={position:s,icon:t.locations[i].map_icon,id:i,content:t.locations[i].info_window_content};t.markers[i]=t.render_marker(r),"markers_clusterer"==t.grouping_type&&"function"==typeof MarkerClusterer?(t.clusters.addMarker(t.markers[i]),google.maps.event.addListener(t.markers[i],"click",function(){t.marker_click(this)})):"markers_spiderfier"==t.grouping_type&&"function"==typeof OverlappingMarkerSpiderfier?(t.spiderfiers.addMarker(t.markers[i]),t.markers[i].setMap(t.map),google.maps.event.addListener(t.markers[i],"spider_click",function(){t.marker_click(this)})):(t.markers[i].setMap(t.map),google.maps.event.addListener(t.markers[i],"click",function(){t.marker_click(this)}))}else GMW.do_action("gmw_map_after_render_markers",o,this),(n>0||0!=t.user_marker)&&t.center_map()},GMW_Map.prototype.center_map=function(){var o=this;if(0==o.zoom_position||o.auto_zoom_level)1==o.locations.length&&0==o.user_position?(o.auto_zoom_level?o.map.setZoom(13):o.map.setZoom(parseInt(o.options.zoom)),o.map.panTo(o.markers[0].getPosition())):o.auto_zoom_level||0==o.user_position?(o.auto_zoom_level||0==o.user_position)&&o.map.fitBounds(o.bounds):(o.map.setZoom(parseInt(o.options.zoom)),o.map.panTo(o.user_position));else{var e=new google.maps.LatLng(o.zoom_position.lat,o.zoom_position.lng);o.map.setZoom(parseInt(o.options.zoom)),o.map.panTo(e)}},GMW_Map.prototype.marker_click=function(o){GMW.do_action("gmw_map_marker_click",o,this),this.active_marker=o,"undefined"!=typeof directionsDisplay&&directionsDisplay.setMap(null),this.close_info_window();var e=this.info_window_type+"_info_window_init";"function"==typeof this[e]?this[e](o):console.log("The function "+e+" not exists.")},GMW_Map.prototype.close_info_window=function(){GMW.do_action("gmw_map_close_info_window",this.info_window_type,this);var o=this.info_window_type+"_info_window_close";"function"==typeof this[o]?this[o]():console.log("The function "+o+" not exists.")},GMW_Map.prototype.standard_info_window_close=function(){this.active_info_window&&(this.active_info_window.close(),this.active_info_window=null)},GMW_Map.prototype.standard_info_window_init=function(o){o.iw_content&&(this.active_info_window=new google.maps.InfoWindow({content:'<div class="gmw-info-window standard map-'+this.id+" "+this.prefix+'">'+o.iw_content+"</div>",maxWidth:200,minWidth:200}),this.active_info_window.open(this.map,o))},jQuery(document).ready(function(o){"undefined"!=typeof gmwMapObjects&&jQuery.each(gmwMapObjects,function(o,e){e.settings.render_map&&(GMW_Maps[o]=new GMW_Map(e.settings,e.map_options,e.form),GMW_Maps[o].render(e.locations,e.user_location))})});